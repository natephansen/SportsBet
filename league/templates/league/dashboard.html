{% extends "league/base.html" %}
{% block title %}Dashboard • {{ season.year }}{% endblock %}
{% block content %}
<h2>League Dashboard — {{ season.year }}</h2>

<h4 class="mt-3">Team Parlays (settled)</h4>

{# ----- Filter bar (responsive) ----- #}
<style>
  #filtersForm { display:flex; flex-wrap:wrap; gap:12px; align-items:end; margin-bottom:1rem; }
  #filtersForm > div { flex: 1 1 180px; min-width: 160px; }
  #filtersForm label { display:block; font-weight:600; margin-bottom:4px; }
  #filtersForm select { width:100%; box-sizing:border-box; }
  @media (max-width: 640px) {
    #filtersForm > div { flex-basis: 100%; }
  }
</style>

<form id="filtersForm" method="get">
  <div>
    <label>Week</label>
    <select name="week" onchange="this.form.submit()">
      <option value="">All Weeks</option>
      {% for w in filter_weeks %}
        <option value="{{ w }}" {% if sel_week|default:'' == w|stringformat:'s' %}selected{% endif %}>Week {{ w }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label>User</label>
    <select name="user" onchange="this.form.submit()">
      <option value="">All Users</option>
      {% for u in filter_users %}
        <option value="{{ u.username }}" {% if sel_user == u.username %}selected{% endif %}>{{ u.username }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label>Team</label>
    <select name="team" onchange="this.form.submit()">
      <option value="">All Teams</option>
      {% for t in filter_teams %}
        <option value="{{ t.id }}" {% if sel_team|default:'' == t.id|stringformat:'s' %}selected{% endif %}>{{ t.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label>Parlay (Individual Bets)</label>
    <select name="parlay" onchange="this.form.submit()">
      <option value="" {% if not sel_parlay %}selected{% endif %}>All</option>
      <option value="yes" {% if sel_parlay == 'yes' %}selected{% endif %}>Parlay Only</option>
      <option value="no"  {% if sel_parlay == 'no'  %}selected{% endif %}>Non-Parlay Only</option>
    </select>
  </div>

  <div style="align-self:center;">
    <a class="btn btn-sm btn-outline-secondary" href="{% url 'league_dashboard' season.year %}">Reset</a>
  </div>
</form>

<table class="table table-striped table-hover align-middle">
  <thead>
    <tr><th>Week</th><th>Team</th><th>Decimal Odds</th><th>Status</th><th>PnL (units)</th></tr>
  </thead>
  <tbody>
    {% for p in parlays %}
      <tr>
        <td>{{ p.week }}</td>
        <td>{{ p.team.name }}</td>
        <td>{{ p.decimal_odds }}</td>
        <td>{{ p.status }}</td>
        <td>{{ p.pnl_units|floatformat:2 }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="5"><em>No settled parlays yet.</em></td></tr>
    {% endfor %}
  </tbody>
</table>

<h4 class="mt-4">Individual Bets (settled)</h4>
<table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>Week</th><th>User</th><th>Team</th>
      <th>Type</th><th>Pick</th><th>Line</th><th>Odds</th>
      <th>Parlay?</th><th>Status</th><th>PnL (units)</th>
    </tr>
  </thead>
  <tbody>
    {% for b in bets %}
      <tr>
        <td>{{ b.week }}</td>
        <td>{{ b.user.username }}</td>
        <td>{{ b.team.name }}</td>
        <td>{{ b.bet_type }}</td>
        <td>{{ b.pick_text }}</td>
        <td>{{ b.line }}</td>
        <td>{{ b.american_odds }}</td>
        <td>{% if b.parlay_selected %}✔{% endif %}</td>
        <td>{{ b.status }}</td>
        <td>{{ b.pnl_units|floatformat:2 }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="10"><em>No settled bets yet.</em></td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
